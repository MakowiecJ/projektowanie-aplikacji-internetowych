<h2>Lista Ogłoszeń</h2>

<form action="/posts" method="GET" class="search-form">
  <div class="form-group">
    <label for="search">Wyszukaj:</label>
    <input type="text" id="search" name="search" placeholder="Szukaj wg tytułu lub opisu" value="<%= search || '' %>">
  </div>
  <div class="form-group">
    <label for="category">Kategoria:</label>
    <select id="category" name="category">
      <option value="">-- Wybierz kategorię --</option>
      <option value="Motoryzacja" <%= category === 'Motoryzacja' ? 'selected' : '' %>>Motoryzacja</option>
      <option value="Nieruchomości" <%= category === 'Nieruchomości' ? 'selected' : '' %>>Nieruchomości</option>
      <option value="Elektronika" <%= category === 'Elektronika' ? 'selected' : '' %>>Elektronika</option>
      <option value="Moda" <%= category === 'Moda' ? 'selected' : '' %>>Moda</option>
      <option value="Sport" <%= category === 'Sport' ? 'selected' : '' %>>Sport</option>
      <option value="Hobby" <%= category === 'Hobby' ? 'selected' : '' %>>Hobby</option>
      <option value="Usługi" <%= category === 'Usługi' ? 'selected' : '' %>>Usługi</option>
      <option value="Praca" <%= category === 'Praca' ? 'selected' : '' %>>Praca</option>
    </select>
  </div>
  <button type="submit">Szukaj</button>
</form>

<div class="post-list">
  <% posts.forEach(post => { %>
    <a href="/posts/<%= post.id %>" class="post-item-link">
      <div class="post-item">
        <div class="post-images">
          <% if (post.images.length > 1) { %>
            <div class="slider">
              <div class="slides">
                <% post.images.forEach((image, index) => { %>
                  <img src="data:<%= image.extension %>;charset=utf-8;base64,<%= image.data.toString('base64') %>" alt="Zdjęcie ogłoszenia" class="<%= index === 0 ? 'active' : '' %>">
                <% }) %>
              </div>
              <button class="prev" onclick="prevSlide(event); event.stopPropagation();">&#10094;</button>
              <button class="next" onclick="nextSlide(event); event.stopPropagation();">&#10095;</button>
            </div>
          <% } else if (post.images.length === 1) { %>
            <img src="data:<%= post.images[0].extension %>;charset=utf-8;base64,<%= post.images[0].data.toString('base64') %>" alt="Zdjęcie ogłoszenia">
          <% } %>
        </div>
        <div class="post-content">
          <h3><%= post.title %></h3>
          <p>Kategoria: <%= post.category %></p>
          <p>Autor: <%= post.author.username || "Anonymous" %></p>
        </div>
      </div>
    </a>
  <% }) %>
</div>

<script>
  function nextSlide(event) {
    event.preventDefault();
    event.stopPropagation();
    const slider = event.target.closest('.slider');
    const slides = slider.querySelector('.slides');
    const activeSlide = slides.querySelector('.active');
    let nextSlide = activeSlide.nextElementSibling;
    if (!nextSlide) nextSlide = slides.firstElementChild;
    activeSlide.classList.remove('active');
    nextSlide.classList.add('active');
  }

  function prevSlide(event) {
    event.preventDefault();
    event.stopPropagation();
    const slider = event.target.closest('.slider');
    const slides = slider.querySelector('.slides');
    const activeSlide = slides.querySelector('.active');
    let prevSlide = activeSlide.previousElementSibling;
    if (!prevSlide) prevSlide = slides.lastElementChild;
    activeSlide.classList.remove('active');
    prevSlide.classList.add('active');
  }
</script>
